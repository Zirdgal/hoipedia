<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="./s.css">



    <title>HoiPedia</title>
</head>
<body>
    <nav>
        <div id="nav-inner">
            <a href="./index.html">HoiPedia</a>
            <a href="./html/games.html">Games</a>
            <a href="./html/players.html">Players</a>
            <a href="./html/rating.html">Rating</a>
        </div>
    </nav>
    <div class="homepage">
        <div class="homepage-games">
            <h1>Latest Games</h1>
            <table id="gamesTable">
            <thead>
                <tr>
                <th>Name</th>
                <th>Winning Team</th>
                <th>Top Player</th>
                <th>Rating 0.2</th>
                <th>Date</th>
                </tr>
            </thead>
            <tbody></tbody>
            </table>
        </div>
        <div class="homepage-players">
            <h2>Players:</h2>
            <ul id="player-list" class="vert-player-list">
                <li class="player-entry"><a href="./html/players/zirdgal.html"><p>Zirdgal</p></a></li>
                <li class="player-entry"><a href="./html/players/thatoneseal.html"><p>That_One_Seal</p></a></li>
                <li class="player-entry"><a href="./html/players/gibbster.html"><p>Gibbster</p></a></li>
                <li class="player-entry"><a href="./html/players/rodevs.html"><p>RoDevs</p></a></li>
                <li class="player-entry"><a href="./html/players/odobuz.html"><p>Odobuz</p></a></li>
            </ul>
            <a href="./html/players.html">More Players &rarr;</a>
        </div>
    </div>



<!--<script src="./script/sortList.js" defer></script> -->
<script>
    fetch('./gameStats/index.json')
        .then(res => res.json())
        .then(files => {
            return Promise.all(
                files.map(file => fetch(`./gameStats/${file}`).then(r => r.json()))
            );
        })
        .then(allGames => {
            const tbody = document.querySelector('#gamesTable tbody');
            allGames.forEach(game => {
                // Sort players by rating and take the top one
                const topPlayer = game.players.sort((a, b) => b.rating - a.rating)[0];
    
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${game.name}</td>
            <td>${game.winningTeam}</td>
            <td>${topPlayer.user} (${topPlayer.country})</td>
            <td>${topPlayer.rating.toFixed(2)}</td>
            <td>${game.date}</td>
          `;
                // Add click listener that redirects to the game's link
                row.style.cursor = 'pointer';  // change cursor on hover to indicate clickable
                row.addEventListener('click', () => {
                    window.location.href = game.link;
                });
          
                tbody.appendChild(row);
            });
        })
        .catch(err => console.error('Error loading games:', err));
</script>
</body>
</html>